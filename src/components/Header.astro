---
import {
  Home,
  Briefcase,
  Users,
  Gift,
  FileText,
  Info,
  Mail,
  Menu,
  X,
  Sun,
  Moon
} from "lucide-react";

const currentPath = Astro.url.pathname;

const links = [
  { href: "/", label: "Inicio", icon: Home },
  { href: "/services", label: "Servicios", icon: Briefcase },
  { href: "/doctors", label: "Doctores", icon: Users },
  { href: "/promotions", label: "Promociones", icon: Gift },
  { href: "/blog", label: "Blog", icon: FileText },
  { href: "/about", label: "Nosotros", icon: Info }
];
---
<header class="bg-[var(--bg-default)] text-[var(--text-default)] shadow sticky top-0 z-50">
  <div class="container mx-auto px-4 py-3 flex items-center justify-between">
    <!-- LOGO -->
    <a href="/" aria-label="Inicio - OptimusLab" class="flex items-center gap-2 transition-all duration-500 hover:scale-x-105">
      <img
        src="/images/logo.png"
        alt="Logo OPTIMUS-LAB"
        class="h-10 w-auto max-w-[200px] object-contain transition-transform duration-500 ease-out"
        loading="lazy"
      />
    </a>

    <!-- NAVEGACIÓN DESKTOP -->
    <nav class="hidden md:flex items-center gap-6 text-sm font-medium" aria-label="Navegación principal">
      {links.map(link => {
        const isActive = currentPath === link.href;
        const Icon = link.icon;
        return (
          <a
            href={link.href}
            class={`flex items-center gap-2 relative transition-all duration-300 transform hover:scale-105
              ${isActive
                ? 'text-[var(--color-primary)] font-semibold after:absolute after:-bottom-1 after:left-0 after:w-full after:h-[2px] after:bg-[var(--color-primary)] after:rounded-full'
                : 'text-[var(--text-default)] hover:text-[var(--color-primary)]'
              }`}
          >
            <Icon size={20} />
            {link.label}
          </a>
        );
      })}

      <a
        href="/contact"
        class="btn-primary flex items-center gap-2 px-5 py-2 rounded-[var(--radius-lg)] shadow-md font-semibold transform hover:scale-105 transition-all"
      >
        <Mail size={20} /> Contáctanos
      </a>
    </nav>

    <!-- BOTONES: MENÚ MÓVIL + TOGGLE TEMA -->
    <div class="flex items-center gap-2">
      <!-- BOTÓN TOGGLE TEMA -->
      <button
        id="themeToggle"
        class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors text-gray-700 dark:text-gray-200"
        aria-label="Cambiar tema claro/oscuro"
      >
        <Sun id="sunIcon" size={20} className="hidden" />
        <Moon id="moonIcon" size={20} />
      </button>

      <!-- BOTÓN MENÚ MÓVIL -->
      <button
        id="menuButton"
        class="md:hidden text-gray-700 dark:text-gray-200 hover:text-[var(--color-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] rounded p-1 transition-colors"
        aria-label="Abrir menú de navegación"
        aria-expanded="false"
        aria-controls="mobileMenu"
      >
        <Menu id="menuIcon" size={26} />
        <X id="closeIcon" size={26} className="hidden" />
      </button>
    </div>
  </div>

  <!-- OVERLAY -->
  <div id="overlay" class="hidden fixed inset-0 bg-black/60 z-40 transition-opacity duration-300"></div>

  <!-- MENÚ MÓVIL -->
  <nav
    id="mobileMenu"
    class="fixed top-0 right-0 h-full w-72 bg-[var(--bg-default)] shadow-xl transform translate-x-full transition-transform duration-300 ease-in-out z-50 flex flex-col py-8 px-6 gap-6"
    role="menu"
    aria-label="Navegación móvil"
  >
    <button id="drawerClose" class="self-end text-gray-700 dark:text-gray-200 hover:text-[var(--color-primary)] focus:outline-none">
      <X size={28} />
    </button>

    {links.map(link => {
      const isActive = currentPath === link.href;
      const Icon = link.icon;
      return (
        <a
          href={link.href}
          class={`flex items-center gap-3 text-lg font-medium transition-all duration-300 transform hover:scale-105
            ${isActive ? 'text-[var(--color-primary)] font-semibold' : 'hover:text-[var(--color-primary)] text-[var(--text-default)] dark:text-[var(--text-default)]'}`}
        >
          <Icon size={20} />
          {link.label}
        </a>
      );
    })}

    <div class="pt-6 border-t border-gray-200 dark:border-gray-700">
      <a
        href="/contact"
        class="btn-primary flex justify-center items-center gap-2 w-full px-6 py-3 rounded-[var(--radius-lg)] hover:bg-[var(--color-primary)/90] shadow-lg text-lg font-semibold transform hover:scale-105 transition-all"
      >
        <Mail size={20} /> Contáctanos
      </a>
    </div>
  </nav>

  <!-- SCRIPT MENÚ MÓVIL + TOGGLE TEMA -->
  <script is:inline>
    document.addEventListener("DOMContentLoaded", () => {
      // ====== MENÚ MÓVIL ======
      const btn = document.getElementById("menuButton");
      const menu = document.getElementById("mobileMenu");
      const overlay = document.getElementById("overlay");
      const menuIcon = document.getElementById("menuIcon");
      const closeIcon = document.getElementById("closeIcon");
      const drawerClose = document.getElementById("drawerClose");

      if (btn && menu && overlay && menuIcon && closeIcon && drawerClose) {
        const toggleMenu = () => {
          const expanded = btn.getAttribute("aria-expanded") === "true";
          btn.setAttribute("aria-expanded", String(!expanded));
          menu.classList.toggle("translate-x-full");
          overlay.classList.toggle("hidden");
          menuIcon.classList.toggle("hidden");
          closeIcon.classList.toggle("hidden");
        };
        btn.addEventListener("click", toggleMenu);
        overlay.addEventListener("click", toggleMenu);
        drawerClose.addEventListener("click", toggleMenu);
      }

      // ====== TOGGLE TEMA CLARO/OSCURO ======
      const themeBtn = document.getElementById("themeToggle");
      const sunIcon = document.getElementById("sunIcon");
      const moonIcon = document.getElementById("moonIcon");

      const applyTheme = () => {
        const savedTheme = localStorage.getItem("theme");
        if (savedTheme === "dark" || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add("dark");
          sunIcon.classList.remove("hidden");
          moonIcon.classList.add("hidden");
        } else {
          document.documentElement.classList.remove("dark");
          sunIcon.classList.add("hidden");
          moonIcon.classList.remove("hidden");
        }
      };

      applyTheme();

      themeBtn.addEventListener("click", () => {
        const isDark = document.documentElement.classList.toggle("dark");
        localStorage.setItem("theme", isDark ? "dark" : "light");
        sunIcon.classList.toggle("hidden");
        moonIcon.classList.toggle("hidden");
      });
    });
  </script>
</header>
