---
/**
 * Layout.astro
 *
 * Plantilla base del sitio web de OPTIMUS-LAB.
 * Incluye SEO, Header, Footer y carga de estilos globales.
 */

import "../styles/global.css";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { getLayoutData } from "../services/layoutService";

// ✅ Props opcionales recibidos desde cada página
const {
  title: customTitle,
  description: customDescription,
  ogImage: customOgImage,
  canonical: customCanonical,
  robots: customRobots,
} = Astro.props;

// ✅ Datos globales del sitio
const { siteInfo, seoData, socialData } = await getLayoutData();

const {
  title,
  description,
  author,
  publisher,
  lang,
  baseUrl,
  siteName,
  themeColor,
} = siteInfo;

const {
  keywords,
  ogUrl,
  ogImage,
  ogType,
  ogLocale,
  geoRegion,
  geoPosition,
  geoPlaceName,
  robots,
  schemaType,
} = seoData;

const { twitterUser, sameAs } = socialData;

// ✅ Prioridad: props > data global
const metaTitle = customTitle || title;
const metaDescription = customDescription || description;
const metaOgImage = customOgImage || ogImage;
const metaRobots = customRobots || robots;
const canonical = customCanonical || ogUrl || undefined;
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- ✅ Título dinámico -->
    <title>{metaTitle}</title>

    <!-- SEO básico -->
    <meta name="description" content={metaDescription} />
    <meta name="keywords" content={keywords} />
    <meta name="author" content={author} />
    <meta name="robots" content={metaRobots} />

    <!-- Navegador y UI -->
    <meta name="theme-color" content={themeColor} />
    <meta name="generator" content="Astro" />

    <!-- ✅ Canonical dinámico -->
    {canonical && <link rel="canonical" href={canonical} />}

    <!-- ✅ Open Graph -->
    <meta property="og:title" content={metaTitle} />
    <meta property="og:description" content={metaDescription} />
    <meta property="og:type" content={ogType} />
    <meta property="og:locale" content={ogLocale} />
    <meta property="og:site_name" content={siteName} />
    <meta property="og:url" content={canonical ?? baseUrl} />
    <meta property="og:image" content={metaOgImage} />

    <!-- ✅ Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content={twitterUser} />
    <meta name="twitter:title" content={metaTitle} />
    <meta name="twitter:description" content={metaDescription} />
    <meta name="twitter:image" content={metaOgImage} />

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="mask-icon" href="/favicon.svg" color={themeColor} />
    <meta name="msapplication-TileColor" content={themeColor} />
    <link rel="manifest" href="/site.webmanifest" />

    <!-- JSON-LD Dinámico -->
    <script type="application/ld+json">
      {JSON.stringify({
        "@context": "https://schema.org",
        "@type": schemaType,
        "name": siteName,
        "url": baseUrl,
        "logo": `${baseUrl}/assets/og-default.png`,
        "image": metaOgImage || `${baseUrl}/assets/og-default.png`,
        "telephone": "+504-88008800",
        "priceRange": "$$",
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "Calle Principal #123",
          "addressLocality": "Tegucigalpa",
          "addressRegion": "FM",
          "postalCode": "11101",
          "addressCountry": "HN"
        },
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": 14.0818,
          "longitude": -87.2068
        },
        "openingHours": "Mo-Fr 08:00-17:00",
        "sameAs": sameAs,
      })}
    </script>

    <!-- Extra -->
    <meta name="application-name" content={siteName} />
    <meta name="apple-mobile-web-app-title" content={siteName} />
    <meta name="format-detection" content="telephone=no" />
  </head>

  <body class="min-h-screen flex flex-col bg-white text-gray-800 font-sans antialiased">
    <Header />

    <main  class="flex-1">
      <slot />
    </main>

    <Footer />
  </body>
</html>
