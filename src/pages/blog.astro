---
/**
 * P√°gina de Blog - Optimus-LAB
 *
 * TODO: Modifica SOLO las variables bajo la secci√≥n "CONFIG / DATA" para a√±adir contenido.
 */
import Layout from "../layouts/Layout.astro";

// ==========================
// üîß CONFIGURACI√ìN / DATA
// ==========================
const siteName = "Optimus-LAB";
const pageTitle = "Blog";
const pageDescription =
  "Art√≠culos, gu√≠as y noticias sobre diagn√≥stico cl√≠nico, prevenci√≥n y salud. Mantente informado con Optimus-LAB.";
const heroImage = "/images/blog1.png";

// Control de paginaci√≥n (renderiza la primera p√°gina con estos valores)
const postsPerPage = 6;
const currentPage = 1; // cambiar si se generan p√°ginas est√°ticas separadas

// Lista de posts (orden deseado: m√°s reciente primero)
// Modifica, a√±ade o elimina objetos. Mant√©n propiedad `slug` √∫nica.
const posts = [
  {
    title: "Importancia del Hemograma en la Atenci√≥n Primaria",
    slug: "",
    excerpt: "El hemograma es una herramienta esencial... aprende cu√°ndo solicitarlo y c√≥mo interpretar resultados b√°sicos.",
    date: "2025-09-02",
    author: "Dra. Ana Mart√≠nez",
    image: "/images/blog1.png",
    alt: "Microscopio y resultados hemograma",
    category: "Hematolog√≠a",
    tags: ["hemograma", "hematolog√≠a", "diagn√≥stico"],
    featured: true,
    readingTime: "4 min",
  },
  {
    title: "Gu√≠a r√°pida: Preparaci√≥n para ex√°menes de laboratorio",
    slug: "",
    excerpt:
      "Consejos pr√°cticos para preparar muestras y obtener resultados precisos en tus an√°lisis de sangre y orina.",
    date: "2025-08-18",
    author: "Lic. Mar√≠a Fern√°ndez",
    image: "/images/blog2.png",
    alt: "Instrucciones preparaci√≥n ex√°menes",
    category: "Gu√≠as",
    tags: ["preparaci√≥n", "muestras", "paciente"],
    featured: false,
    readingTime: "3 min",
  },
  {
    title: "Colesterol: ¬øcu√°ndo preocuparse?",
    slug: "",
    excerpt:
      "Entiende los niveles de colesterol, factores de riesgo y medidas preventivas basadas en evidencia.",
    date: "2025-07-10",
    author: "Dr. Carlos L√≥pez",
    image: "/images/blog3.png",
    alt: "Resultados de colesterol",
    category: "Bioqu√≠mica",
    tags: ["colesterol", "salud cardiovascular"],
    featured: false,
    readingTime: "5 min",
  },
  {
    title: "Avances en automatizaci√≥n de laboratorios cl√≠nicos",
    slug: "automatizacion-laboratorios",
    excerpt:
      "C√≥mo la automatizaci√≥n mejora la precisi√≥n, reduce tiempos y minimiza errores humanos en el laboratorio.",
    date: "2025-06-25",
    author: "Editorial Optimus-LAB",
    image: "/images/blog4.png",
    alt: "Equipo automatizado laboratorio",
    category: "Tecnolog√≠a",
    tags: ["automatizaci√≥n", "equipos", "calidad"],
    featured: false,
    readingTime: "6 min",
  },
  {
    title: "Chequeos preventivos para mujeres: pruebas recomendadas",
    slug: "",
    excerpt:
      "Lista de ex√°menes preventivos para diferente etapas de la vida femenina y su frecuencia recomendada.",
    date: "2025-05-12",
    author: "Dra. Ana Mart√≠nez",
    image: "/images/blog1.png",
    alt: "Mujer en consulta m√©dica",
    category: "Prevenci√≥n",
    tags: ["prevenci√≥n", "mujer", "salud"],
    featured: false,
    readingTime: "5 min",
  },
  {
    title: "Interpretaci√≥n r√°pida de ex√°menes renales",
    slug: "examenes-renales",
    excerpt:
      "Creatinina, BUN y otros marcadores: qu√© representan y cu√°ndo derivar al especialista.",
    date: "2025-04-04",
    author: "Dr. Carlos L√≥pez",
    image: "/images/blog2.png",
    alt: "Resultados pruebas renales",
    category: "Nefrolog√≠a",
    tags: ["ri√±√≥n", "creatinina", "BUN"],
    featured: false,
    readingTime: "4 min",
  },
  // a√±ade m√°s posts seg√∫n necesites...
];

// Generar lista √∫nica de categor√≠as desde los posts (server-side)
const categories = Array.from(new Set(posts.map((p) => p.category))).sort();

// Recent posts (por fecha; aqu√≠ simple slice del array ordenado)
const recentPosts = posts.slice(0, 4);

// Featured: primer post con featured=true, si existe.
const featuredPost = posts.find((p) => p.featured) ?? posts[0];

// Calcular paginaci√≥n (simple)
const totalPosts = posts.length;
const totalPages = Math.max(1, Math.ceil(totalPosts / postsPerPage));
const startIndex = (currentPage - 1) * postsPerPage;
const endIndex = startIndex + postsPerPage;
const pagePosts = posts.slice(startIndex, endIndex);
---

<Layout title={`${pageTitle} - ${siteName}`} description={pageDescription}>
  <!-- HERO -->
  <section class="relative bg-gradient-to-r from-blue-950 to-blue-700 text-white py-28 overflow-hidden">
    <div class="absolute inset-0">
      <img src={heroImage} alt="Blog Optimus-LAB" class="w-full h-full object-cover opacity-20" loading="lazy" />
    </div>
    <div class="relative max-w-6xl mx-auto px-6 text-center">
      <h1 class="text-4xl md:text-5xl font-extrabold mb-3">{pageTitle}</h1>
      <p class="text-lg md:text-xl text-blue-100 max-w-3xl mx-auto">{pageDescription}</p>
      <div class="mt-8 flex items-center justify-center gap-4">
        <a href="/blog" class="inline-flex items-center gap-2 bg-white/10 hover:bg-white/20 px-4 py-2 rounded-full text-sm">
          Ver todas las entradas
        </a>
        <a href="/contact" class="inline-flex items-center gap-2 bg-white text-blue-900 px-4 py-2 rounded-full font-semibold">
          Cont√°ctanos
        </a>
      </div>
    </div>
  </section>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="max-w-6xl mx-auto px-6 -mt-12 relative z-10">
    <div class="grid lg:grid-cols-3 gap-8">
      <!-- MAIN: POSTS -->
      <section class="lg:col-span-2">
        <!-- Featured Post -->
        {featuredPost && (
          <article class="bg-white rounded-3xl shadow-lg overflow-hidden mb-8">
            <div class="md:flex">
              <img src={featuredPost.image} alt={featuredPost.alt} class="w-full md:w-1/2 h-64 object-cover" loading="lazy" />
              <div class="p-8 md:w-1/2">
                <div class="flex items-center gap-3 text-sm text-gray-500 mb-3">
                  <span class="px-3 py-1 rounded-full bg-blue-50 text-blue-600 font-medium">{featuredPost.category}</span>
                  <span>‚Ä¢</span>
                  <span>{featuredPost.date}</span>
                  <span>‚Ä¢</span>
                  <span>{featuredPost.readingTime}</span>
                </div>
                <h2 class="text-2xl font-semibold text-gray-900 mb-3">{featuredPost.title}</h2>
                <p class="text-gray-600 mb-6">{featuredPost.excerpt}</p>
                <div class="flex items-center justify-between">
                  <div class="text-sm text-gray-700">Por <strong>{featuredPost.author}</strong></div>
                  <a href={`/blog/${featuredPost.slug}`} class="inline-block bg-blue-600 text-white px-4 py-2 rounded-full text-sm font-medium hover:bg-blue-700">Leer m√°s</a>
                </div>
              </div>
            </div>
          </article>
        )}

        <!-- Grid de posts -->
        <div class="grid sm:grid-cols-2 gap-6">
          {pagePosts.map((post) => (
            <article class="bg-white rounded-2xl shadow hover:shadow-lg transition overflow-hidden" data-category={post.category} data-tags={post.tags?.join(",")}>
              <a href={`/blog/${post.slug}`} class="block">
                <img src={post.image} alt={post.alt} class="w-full h-44 object-cover" loading="lazy" />
                <div class="p-5">
                  <div class="text-xs text-gray-500 mb-2">
                    <span class="inline-block bg-blue-50 text-blue-600 px-2 py-1 rounded-full text-xs">{post.category}</span>
                    <span class="ml-2">{post.date}</span>
                  </div>
                  <h3 class="text-lg font-semibold text-gray-900 mb-2">{post.title}</h3>
                  <p class="text-sm text-gray-600 mb-4">{post.excerpt}</p>
                  <div class="flex items-center justify-between text-sm text-gray-700">
                    <span>Por <strong>{post.author}</strong></span>
                    <span>{post.readingTime}</span>
                  </div>
                </div>
              </a>
            </article>
          ))}
        </div>

        <!-- PAGINACI√ìN -->
        <nav class="mt-8 flex items-center justify-center gap-3" aria-label="Paginaci√≥n">
          <button class="px-4 py-2 rounded-full bg-white shadow-sm text-sm" disabled={currentPage <= 1}>Anterior</button>
          {Array.from({ length: totalPages }, (_, i) => i + 1).map((p) => (
            <a href={`/blog?page=${p}`} class={`px-4 py-2 rounded-full text-sm ${p === currentPage ? "bg-blue-700 text-white" : "bg-white"}`} aria-current={p === currentPage ? "page" : undefined}>
              {p}
            </a>
          ))}
          <button class="px-4 py-2 rounded-full bg-white shadow-sm text-sm" disabled={currentPage >= totalPages}>Siguiente</button>
        </nav>
      </section>

      <!-- SIDEBAR -->
      <aside class="space-y-6">
        <!-- Search -->
        <div class="bg-white rounded-2xl shadow p-4">
          <label for="search" class="block text-sm font-medium text-gray-700 mb-2">Buscar art√≠culos</label>
          <div class="relative">
            <input id="search" type="search" placeholder="Buscar por t√≠tulo, tag o palabra clave..." class="w-full border border-gray-200 rounded-full px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-200" />
            <button id="clearSearch" type="button" class="absolute right-2 top-2.5 text-gray-400 text-sm hidden">Limpiar</button>
          </div>
        </div>

        <!-- Categories -->
        <div class="bg-white rounded-2xl shadow p-4">
          <h4 class="text-sm font-semibold text-gray-800 mb-3">Categor√≠as</h4>
          <div class="flex flex-wrap gap-2">
            <button data-filter="all" type="button" class="filter-btn px-3 py-1 rounded-full bg-blue-50 text-blue-700 text-xs">Todas</button>
            {categories.map((c) => (
              <button data-filter={c} type="button" class="filter-btn px-3 py-1 rounded-full bg-gray-100 text-gray-800 text-xs">{c}</button>
            ))}
          </div>
        </div>

        <!-- Recent Posts -->
        <div class="bg-white rounded-2xl shadow p-4">
          <h4 class="text-sm font-semibold text-gray-800 mb-3">Recientes</h4>
          <ul class="space-y-3">
            {recentPosts.map((rp) => (
              <li class="flex items-start gap-3">
                <img src={rp.image} alt={rp.alt} class="w-14 h-10 object-cover rounded-md" loading="lazy" />
                <div>
                  <a href={`/blog/${rp.slug}`} class="text-sm font-medium text-gray-900">{rp.title}</a>
                  <div class="text-xs text-gray-500">{rp.date}</div>
                </div>
              </li>
            ))}
          </ul>
        </div>

        <!-- Newsletter / Banner -->
        <div class="bg-gradient-to-r from-blue-700 to-blue-500 text-white rounded-2xl p-6 text-center shadow">
          <h4 class="text-lg font-semibold mb-2">Suscr√≠bete al bolet√≠n</h4>
          <p class="text-sm mb-4">Recibe actualizaciones, gu√≠as y promociones directamente en tu correo.</p>
          <!-- <- Aqu√≠ quitamos `on:submit` y agregamos id al form para manejar submit desde JS -->
          <form id="newsletterForm" class="flex gap-2">
            <input id="newsletterEmail" name="email" type="email" placeholder="Tu correo electr√≥nico" aria-label="Tu correo" class="w-full rounded-full px-4 py-2 text-sm text-gray-800" required />
            <button id="newsletterBtn" type="submit" class="px-4 py-2 rounded-full bg-white text-blue-700 font-semibold text-sm">Suscribir</button>
          </form>
        </div>

        <!-- Contact CTA -->
        <div class="bg-white rounded-2xl shadow p-4 text-center">
          <h4 class="text-sm font-semibold text-gray-800 mb-2">¬øDudas?</h4>
          <p class="text-sm text-gray-600 mb-4">Cont√°ctanos para m√°s informaci√≥n sobre pruebas y servicios.</p>
          <a href="/contact" class="inline-block bg-blue-600 text-white px-4 py-2 rounded-full text-sm">Contactar</a>
        </div>
      </aside>
    </div>
  </main>

  <!-- JS: Filtrado, b√∫squeda y newsletter (client-side) -->
  <script is:inline>
    (function () {
      // --- filtros y b√∫squeda ---
      const filterBtns = Array.from(document.querySelectorAll(".filter-btn"));
      const posts = Array.from(document.querySelectorAll("article[data-category]"));
      const searchInput = document.getElementById("search");
      const clearBtn = document.getElementById("clearSearch");

      function applyFilter(category) {
        posts.forEach((el) => {
          const cat = el.getAttribute("data-category") || "";
          const matches = category === "all" || cat === category;
          el.style.display = matches ? "" : "none";
        });
      }

      function applySearch(q) {
        const term = q.trim().toLowerCase();
        posts.forEach((el) => {
          const title = (el.querySelector("h3")?.textContent || "").toLowerCase();
          const excerpt = (el.querySelector("p")?.textContent || "").toLowerCase();
          const tags = (el.getAttribute("data-tags") || "").toLowerCase();
          const match = !term || title.includes(term) || excerpt.includes(term) || tags.includes(term);
          el.style.display = match ? "" : "none";
        });
      }

      // Category buttons
      filterBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
          const cat = btn.getAttribute("data-filter");
          // reset search when filtering
          searchInput.value = "";
          clearBtn.classList.add("hidden");
          applyFilter(cat);
          // update active styles
          filterBtns.forEach((b) => b.classList.remove("bg-blue-600", "text-white"));
          btn.classList.add("bg-blue-600", "text-white");
        });
      });

      // Search input
      if (searchInput) {
        searchInput.addEventListener("input", (e) => {
          const q = e.target.value || "";
          if (q.trim().length > 0) clearBtn.classList.remove("hidden");
          else clearBtn.classList.add("hidden");
          applySearch(q);
        });
      }

      if (clearBtn) {
        clearBtn.addEventListener("click", () => {
          searchInput.value = "";
          clearBtn.classList.add("hidden");
          applySearch("");
        });
      }

      // Initialize: show all, set "Todas" active
      const allBtn = document.querySelector('[data-filter="all"]');
      if (allBtn) {
        allBtn.classList.add("bg-blue-600", "text-white");
      }
      applyFilter("all");

      // --- Newsletter: manejar submit del form sin usar atributos inv√°lidos ---
      const newsletterForm = document.getElementById("newsletterForm");
      const newsletterEmail = document.getElementById("newsletterEmail");
      const newsletterBtn = document.getElementById("newsletterBtn");

      if (newsletterForm) {
        newsletterForm.addEventListener("submit", function (ev) {
          ev.preventDefault(); // evita reload
          const email = (newsletterEmail?.value || "").trim();
          if (!email) {
            alert("Por favor ingresa un correo v√°lido.");
            return;
          }
          // Aqu√≠ coloca la integraci√≥n real (API, servicio de mailing, etc.)
          // Ejemplo de comportamiento simulado:
          newsletterBtn.disabled = true;
          newsletterBtn.textContent = "Enviando...";
          setTimeout(() => {
            newsletterBtn.disabled = false;
            newsletterBtn.textContent = "Suscribir";
            newsletterEmail.value = "";
            alert("Gracias por suscribirte. Pronto recibir√°s novedades en tu correo.");
          }, 900);
        });
      }
    })();
  </script>
</Layout>
